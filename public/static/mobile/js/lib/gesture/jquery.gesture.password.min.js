!function(a){function b(b,d){return this.each(function(){var e=a(this),f=a.extend({},c.DEFAULTS,"object"==typeof b&&b),g=e.data("GesturePasswd"),h="string"==typeof b?b:0/0;g||e.data("danmu",g=new c(this,f)),h&&g[h](d)})}var c=function(b,c){this.$element=a(b),this.options=c;var d=this;this.pr=c.pointRadii,this.rr=c.roundRadii,this.o=c.space,this.color=c.color,this.$element.css({position:"relation",width:this.options.width,height:this.options.height,"background-color":c.backgroundColor,overflow:"hidden",cursor:"default"}),a(b).attr("id")||a(b).attr("id",(65535*Math.random()).toString()),this.id="#"+a(b).attr("id");var e=function(a,b){this.x=a,this.y=b};this.result="",this.pList=[],this.sList=[],this.tP=new e(0,0),this.$element.append('<canvas class="main-c" width="'+c.width+'" height="'+c.height+'" >'),this.$c=a(this.id+" .main-c")[0],this.$ctx=this.$c.getContext("2d"),this.initDraw=function(){this.$ctx.strokeStyle=this.color,this.$ctx.lineWidth=2;for(var a=0;3>a;a++)for(var b=0;3>b;b++){this.$ctx.moveTo(this.o/2+2*this.rr+b*(this.o+2*this.rr),this.o/2+this.rr+a*(this.o+2*this.rr)),this.$ctx.arc(this.o/2+this.rr+b*(this.o+2*this.rr),this.o/2+this.rr+a*(this.o+2*this.rr),this.rr,0,2*Math.PI);var c=new e(this.o/2+this.rr+b*(this.o+2*this.rr),this.o/2+this.rr+a*(this.o+2*this.rr));d.pList.length<9&&this.pList.push(c)}this.$ctx.stroke(),this.initImg=this.$ctx.getImageData(0,0,this.options.width,this.options.height)},this.initDraw(),this.isIn=function(a,b){for(var c in d.pList)if(Math.pow(a-d.pList[c].x,2)+Math.pow(b-d.pList[c].y,2)<Math.pow(this.rr,2))return d.pList[c];return 0},this.pointDraw=function(a){arguments.length>0&&(d.$ctx.strokeStyle=a,d.$ctx.fillStyle=a);for(var b in d.sList)d.$ctx.moveTo(d.sList[b].x+d.pr,d.sList[b].y),d.$ctx.arc(d.sList[b].x,d.sList[b].y,d.pr,0,2*Math.PI),d.$ctx.fill()},this.lineDraw=function(a){if(arguments.length>0&&(d.$ctx.strokeStyle=a,d.$ctx.fillStyle=a),d.sList.length>0)for(var b in d.sList)0!=b?(d.$ctx.lineTo(d.sList[b].x,d.sList[b].y),console.log(d.sList[b].x,d.sList[b].y)):(console.log(d.sList[b].x,d.sList[b].y),d.$ctx.moveTo(d.sList[b].x,d.sList[b].y))},this.allDraw=function(a){arguments.length>0?(this.pointDraw(a),this.lineDraw(a),d.$ctx.stroke()):(this.pointDraw(),this.lineDraw())},this.draw=function(a,b){d.$ctx.clearRect(0,0,d.options.width,d.options.height),d.$ctx.beginPath(),d.$ctx.putImageData(this.initImg,0,0),d.$ctx.lineWidth=4,d.pointDraw(d.options.lineColor),d.lineDraw(d.options.lineColor),d.$ctx.lineTo(a,b),d.$ctx.stroke()},this.pointInList=function(a,b){for(var c in b)if(a.x==b[c].x&&a.y==b[c].y)return++c;return!1},this.touched=!1,a(this.id).on("mousedown touchstart",{that:d},function(a){a.data.that.touched=!0}),a(this.id).on("mouseup touchend",{that:d},function(c){c.data.that.touched=!1,d.$ctx.clearRect(0,0,d.options.width,d.options.height),d.$ctx.beginPath(),d.$ctx.putImageData(c.data.that.initImg,0,0),d.allDraw(d.options.lineColor);for(var e in d.sList)c.data.that.pointInList(d.sList[e],c.data.that.pList)&&(c.data.that.result=c.data.that.result+c.data.that.pointInList(d.sList[e],c.data.that.pList).toString());a(b).trigger("hasPasswd",d.result)}),a(this.id).on("touchmove mousemove",{that:d},function(a){if(a.data.that.touched){var b=a.pageX||a.originalEvent.targetTouches[0].pageX,c=a.pageY||a.originalEvent.targetTouches[0].pageY;b-=d.$element.offset().left,c-=d.$element.offset().top;var e=a.data.that.isIn(b,c);console.log(b),0!=e&&(a.data.that.pointInList(e,a.data.that.sList)||a.data.that.sList.push(e)),console.log(a.data.that.sList),a.data.that.draw(b,c)}}),a(this.id).on("passwdWrong",{that:d},function(){d.$ctx.clearRect(0,0,d.options.width,d.options.height),d.$ctx.beginPath(),d.$ctx.putImageData(d.initImg,0,0),d.allDraw("#cc1c21"),d.result="",d.pList=[],d.sList=[],setTimeout(function(){d.$ctx.clearRect(0,0,d.options.width,d.options.height),d.$ctx.beginPath(),d.initDraw()},500)}),a(this.id).on("passwdRight",{that:d},function(){d.$ctx.clearRect(0,0,d.options.width,d.options.height),d.$ctx.beginPath(),d.$ctx.putImageData(d.initImg,0,0),d.allDraw("#00a254"),d.result="",d.pList=[],d.sList=[],setTimeout(function(){d.$ctx.clearRect(0,0,d.options.width,d.options.height),d.$ctx.beginPath(),d.initDraw()},500)})};c.DEFAULTS={zindex:100,roundRadii:25,pointRadii:6,space:30,width:240,height:240,lineColor:"#00aec7",backgroundColor:"#252736",color:"#FFFFFF"},a.fn.GesturePasswd=b,a.fn.GesturePasswd.Constructor=c}(jQuery);